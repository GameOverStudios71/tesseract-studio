// ==========================================================================
// BUILDER PAGE LAYOUT
// ==========================================================================

@use '../base/variables' as *;
@use '../base/mixins' as *;

// --------------------------------------------------------------------------
// Builder Wrapper
// --------------------------------------------------------------------------
.ts-builder-wrapper {
    display: flex;
    flex-direction: column;
    height: calc(100vh - 100px); // Full height minus header and padding
    width: 100%;
    background: transparent;
    // border-radius: var(--st-radius-lg); // Removed radius for seamless look
    overflow: hidden;
    position: relative;
    // border: 1px solid rgba(255, 255, 255, 0.1); // Removed border
    // box-shadow: var(--st-shadow-2xl); // Removed shadow
}

// --------------------------------------------------------------------------
// Flow Container (React Flow)
// --------------------------------------------------------------------------
.ts-flow-container {
    flex: 1;
    width: 100%;
    position: relative;
    overflow: hidden;
    z-index: 1;
}

// --------------------------------------------------------------------------
// React Flow Customizations
// --------------------------------------------------------------------------
.react-flow {
    background: transparent !important; // Fully transparent to show app background
}

.react-flow__controls {
    background: rgba(30, 41, 59, 0.7); // Slate-800 with opacity
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--st-radius-md);
    backdrop-filter: blur(8px);
    box-shadow: var(--st-shadow-lg);
    overflow: hidden;

    button {
        background: transparent;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.8);
        width: 30px;
        height: 30px;

        &:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        &:last-child {
            border-bottom: none;
        }

        svg {
            fill: currentColor;
        }
    }
}

.react-flow__minimap {
    background: rgba(15, 23, 42, 0.6) !important; // Slate-900 glass
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    border-radius: var(--st-radius-lg) !important;
    backdrop-filter: blur(12px) !important;
    -webkit-backdrop-filter: blur(12px) !important;
    box-shadow: var(--st-shadow-lg) !important;
    margin-bottom: var(--st-spacing-md) !important;
    margin-right: var(--st-spacing-md) !important;

    .react-flow__minimap-mask {
        fill: rgba(0, 0, 0, 0.4) !important;
    }

    .react-flow__minimap-node {
        fill: rgba(6, 182, 212, 0.4) !important; // Cyan nodes
        stroke: none !important;
    }
}

// --------------------------------------------------------------------------
// Flow Panel
// --------------------------------------------------------------------------
.ts-flow-panel {
    background: rgba(15, 23, 42, 0.6); // Slate-900 glass
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--st-radius-lg);
    padding: var(--st-spacing-lg);
    color: white;
    z-index: 10;
    backdrop-filter: blur(12px);
    box-shadow: var(--st-shadow-xl);

    &-header {
        margin-bottom: var(--st-spacing-md);

        h2 {
            font-size: 1.25rem;
            font-weight: 700;
            margin: 0 0 0.25rem;
            color: white;
        }

        .project-slug {
            font-size: 0.75rem;
            font-family: 'JetBrains Mono', monospace;
            color: var(--st-color-cyan);
        }
    }

    &-actions {
        margin-top: var(--st-spacing-md);
    }
}

// --------------------------------------------------------------------------
// Flow Info Bar
// --------------------------------------------------------------------------
.ts-flow-info {
    display: flex;
    gap: var(--st-spacing-md);
    background: rgba(15, 23, 42, 0.6);
    padding: var(--st-spacing-sm) var(--st-spacing-md);
    border-radius: var(--st-radius-md);
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(8px);
    z-index: 10;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

// --------------------------------------------------------------------------
// Custom Page Node
// --------------------------------------------------------------------------
.ts-page-node {
    background: rgba(15, 23, 42, 0.6); // Slate-900 glass
    border: 1px solid rgba(6, 182, 212, 0.3); // Cyan border
    border-radius: var(--st-radius-lg);
    min-width: 200px;
    box-shadow: var(--st-shadow-lg);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    transition: all var(--st-transition-fast);
    overflow: hidden;

    &:hover {
        border-color: rgba(6, 182, 212, 0.6);
        box-shadow: 0 0 20px rgba(6, 182, 212, 0.2), var(--st-shadow-xl);
        transform: translateY(-2px);
    }

    &.selected {
        border-color: #22d3ee; // Cyan-400
        box-shadow: 0 0 0 2px rgba(6, 182, 212, 0.3), 0 0 30px rgba(6, 182, 212, 0.3);
    }

    &-header {
        display: flex;
        align-items: center;
        gap: var(--st-spacing-sm);
        padding: var(--st-spacing-sm) var(--st-spacing-md);
        background: linear-gradient(135deg, rgba(6, 182, 212, 0.2) 0%, rgba(6, 182, 212, 0.05) 100%);
        border-bottom: 1px solid rgba(6, 182, 212, 0.1);

        // Home node special styling (if valid)
        // Check React Flow structure for data attribute selectors if needed
    }

    &-icon {
        font-size: 1rem;
        color: #22d3ee;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 24px;
        background: rgba(6, 182, 212, 0.1);
        border-radius: var(--st-radius-md);
    }

    &-label {
        font-weight: 600;
        color: white;
        font-size: 0.875rem;
        flex: 1;
    }

    &-actions {
        display: flex;
        gap: 4px;
    }

    &-body {
        padding: var(--st-spacing-md);
        background: rgba(0, 0, 0, 0.2);
    }

    &-slug {
        font-size: 0.75rem;
        font-family: 'JetBrains Mono', monospace;
        color: rgba(255, 255, 255, 0.5);
        display: block;
        margin-bottom: 4px;

        &::before {
            content: '/';
            color: rgba(6, 182, 212, 0.5);
        }
    }
}