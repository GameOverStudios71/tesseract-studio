<!-- Reload Trigger -->
<nav class="ts-navbar-glass top-0 fixed z-50 w-full border-b border-white/10">
  <div class="w-full h-16 flex items-center justify-between" style="padding-left: 20px; padding-right: 20px;">
    <!-- LOGO -->
    <div class="flex items-center gap-8">
      <a href="/" class="text-xl font-bold tracking-tight text-white/90 hover:text-white transition-colors">
        Tesseract<span class="text-blue-400">Studio</span>
      </a>

      <!-- DYNAMIC PAGE HEADER -->
      <%= if assigns[:header_title] do %>
        <div class="hidden md:flex items-center gap-6 border-l border-white/10 pl-6 h-8">
          <div>
            <h1 class="text-lg font-bold text-white tracking-tight leading-none"><%= @header_title %></h1>
            <%= if assigns[:header_subtitle] do %>
              <p class="text-slate-400 text-[10px] leading-none mt-1"><%= @header_subtitle %></p>
            <% end %>
          </div>
          
          <%= if assigns[:header_actions] do %>
            <div class="flex items-center gap-2">
              <%= @header_actions %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
    
    <!-- USER MENU -->
    <ul class="flex items-center gap-6">
      <%= if @current_scope do %>
        <li class="relative group z-50">
          <button class="flex items-center justify-center rounded-full p-1 hover:bg-white/10 transition-all focus:outline-none">
             <div class="relative w-8 h-8 rounded-full border-2 border-white/50 overflow-hidden shadow-lg bg-white/10 backdrop-blur-md">
                <div class="w-full h-full flex items-center justify-center text-white font-bold text-xs">
                  <%= String.at(@current_scope.user.email, 0) |> String.upcase() %>
                </div>
             </div>
          </button>
          
          <div class="absolute right-0 top-full pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform group-hover:translate-y-0 translate-y-2 group-hover:pointer-events-auto min-w-[260px] z-50">
            <div class="glass-panel-heavy rounded-lg shadow-2xl overflow-hidden divide-y divide-white/10">
              <div class="px-5 py-4 flex items-center gap-3">
                 <div class="relative w-10 h-10 rounded-full border-2 border-white overflow-hidden shrink-0">
                    <div class="w-full h-full bg-blue-500/20 flex items-center justify-center text-blue-200 font-bold">
                      <%= String.at(@current_scope.user.email, 0) |> String.upcase() %>
                    </div>
                 </div>
                 <div class="overflow-hidden">
                    <p class="text-sm font-semibold text-white truncate">User</p>
                    <p class="text-xs text-slate-400 truncate">{@current_scope.user.email}</p>
                 </div>
              </div>

              <div class="py-1">
                 <.link href={~p"/users/settings"} class="flex w-full items-center justify-between px-4 py-2.5 text-sm font-medium text-slate-200 hover:bg-white/10 transition-colors">
                    <span class="flex items-center gap-2">
                       <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-slate-400">
                         <path d="M8 7C6.125 7 4.625 5.525 4.625 3.725C4.625 1.925 6.125 0.449997 8 0.449997C9.875 0.449997 11.375 1.925 11.375 3.725C11.375 5.525 9.875 7 8 7ZM8 1.575C6.75 1.575 5.75 2.55 5.75 3.725C5.75 4.9 6.75 5.875 8 5.875C9.25 5.875 10.25 4.9 10.25 3.725C10.25 2.55 9.25 1.575 8 1.575Z" fill="currentColor"/>
                         <path d="M13.275 15.575C12.975 15.575 12.7 15.325 12.7 15V14.275C12.7 11.675 10.6 9.575 8.00003 9.575C5.40002 9.575 3.30002 11.675 3.30002 14.275V15C3.30002 15.3 3.05002 15.575 2.72502 15.575C2.40002 15.575 2.15002 15.325 2.15002 15V14.275C2.15002 11.05 4.77502 8.45 7.97502 8.45C11.175 8.45 13.8 11.075 13.8 14.275V15C13.825 15.3 13.575 15.575 13.275 15.575Z" fill="currentColor"/>
                       </svg>
                       Profile Settings
                    </span>
                 </.link>
              </div>

              <div class="py-1">
                 <.link href={~p"/users/log-out"} method="delete" class="flex w-full items-center justify-between px-4 py-2.5 text-sm font-medium text-slate-200 hover:bg-white/10 transition-colors">
                    <span class="flex items-center gap-2">
                       <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-slate-400">
                         <path d="M11.3 0.449997H8.47502C7.82502 0.449997 7.27502 0.999997 7.27502 1.65V3.375C7.27502 3.675 7.52502 3.925 7.82502 3.925C8.12502 3.925 8.40002 3.675 8.40002 3.375V1.625C8.40002 1.575 8.42502 1.55 8.47502 1.55H11.3C11.9 1.55 12.375 2.025 12.375 2.625V13.35C12.375 13.95 11.9 14.425 11.3 14.425H8.47502C8.42502 14.425 8.40002 14.4 8.40002 14.35V12.625C8.40002 12.325 8.15002 12.075 7.82502 12.075C7.50002 12.075 7.27502 12.325 7.27502 12.625V14.35C7.27502 15 7.82502 15.55 8.47502 15.55H11.3C12.525 15.55 13.5 14.55 13.5 13.35V2.65C13.5 1.425 12.5 0.449997 11.3 0.449997Z" fill="currentColor"/>
                         <path d="M4.39998 8.55H8.87498C9.17498 8.55 9.42498 8.3 9.42498 8C9.42498 7.7 9.17498 7.45 8.87498 7.45H4.42498L5.97498 5.875C6.19998 5.65 6.19998 5.3 5.97498 5.075C5.74998 4.85 5.39998 4.85 5.17498 5.075L2.67498 7.625C2.44998 7.85 2.44998 8.2 2.67498 8.425L5.17498 10.975C5.27498 11.075 5.42498 11.15 5.57498 11.15C5.72498 11.15 5.84998 11.1 5.97498 11C6.19998 10.775 6.19998 10.425 5.97498 10.2L4.39998 8.55Z" fill="currentColor"/>
                       </svg>
                       Log out
                    </span>
                 </.link>
              </div>
            </div>
          </div>
        </li>
      <% else %>
        <li>
          <.link href={~p"/users/register"} class="text-sm font-medium text-slate-300 hover:text-white transition-colors">Register</.link>
        </li>
        <li>
          <.link href={~p"/users/log-in"} class="px-4 py-2 rounded-lg bg-blue-600/20 border border-blue-500/30 text-blue-400 hover:bg-blue-600/30 hover:text-blue-300 transition-all text-sm font-semibold">Log in</.link>
        </li>
      <% end %>
    </ul>
  </div>
</nav>

<main style="padding: 80px 10px 0 10px;">
  {@inner_content}
</main>

<.flash_group flash={@flash} />
